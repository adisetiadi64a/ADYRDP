name: ğŸªŸ Free Windows RDP (LocalXpose Fixed)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 180

    steps:
    - name: ğŸ’» Setup User RDP
      run: |
        $password = "Akudankamu1@"
        net user Ady $password /add
        net localgroup administrators Ady /add
        Write-Host "âœ… User: Ady / $password dibuat!"

    - name: ğŸ”¥ Disable Windows Firewall
      run: |
        netsh advfirewall set allprofiles state off
        Write-Host "âœ… Firewall dimatikan!"

    - name: â¬‡ï¸ Download LocalXpose (Working Mirror)
      run: |
        Invoke-WebRequest -Uri "https://cdn.jsdelivr.net/gh/ganeshkumar-s/localxpose-mirror/lx-windows-amd64.zip" -OutFile "lx.zip"
        Expand-Archive lx.zip -DestinationPath .
        Write-Host "âœ… LocalXpose berhasil diunduh!"

    - name: ğŸ”‘ Login ke LocalXpose
      env:
        LOCALXPOSE_TOKEN: ${{ secrets.LOCALXPOSE_TOKEN }}
      run: |
        .\lx.exe authtoken $env:LOCALXPOSE_TOKEN
        Write-Host "âœ… Token LocalXpose berhasil digunakan!"

    - name: ğŸš€ Jalankan Tunnel RDP
      run: |
        Start-Process -FilePath ".\lx.exe" -ArgumentList "tcp 3389 --region ap" -NoNewWindow
        Start-Sleep -Seconds 10
        Write-Host "âœ… Tunnel RDP aktif!"
        .\lx.exe tunnels list

    - name: ğŸ“‹ Tampilkan Info Login
      run: |
        Write-Host ""
        Write-Host "===================================="
        Write-Host " ğŸ® WINDOWS RDP AKTIF"
        Write-Host "===================================="
        Write-Host "Username : Ady"
        Write-Host "Password : Akudankamu1@"
        Write-Host "Gunakan alamat dari output di atas (contoh: tcp://0.tcp.ap.localxpose.io:xxxxx)"
        Write-Host "===================================="
        Write-Host "â³ Session bertahan hingga 3 jam."
