name: 🪟 Free RDP Windows (LocalXpose)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 180

    steps:
    - name: 💻 Setup User RDP
      run: |
        $password = "Akudankamu1@"
        net user Ady $password /add
        net localgroup administrators Ady /add
        Write-Host "✅ User: Ady / $password dibuat!"

    - name: 🔥 Disable Windows Firewall
      run: |
        netsh advfirewall set allprofiles state off
        Write-Host "✅ Firewall dimatikan!"

    - name: ⬇️ Download LocalXpose (Fix Mirror)
      run: |
        Invoke-WebRequest -Uri "https://github.com/localxpose/downloads/releases/latest/download/lx-windows-amd64.zip" -OutFile "lx.zip"
        Expand-Archive lx.zip -DestinationPath .
        Write-Host "✅ LocalXpose berhasil diunduh!"

    - name: 🔑 Login ke LocalXpose
      env:
        LOCALXPOSE_TOKEN: ${{ secrets.LOCALXPOSE_TOKEN }}
      run: |
        .\lx.exe authtoken $env:LOCALXPOSE_TOKEN
        Write-Host "✅ Token LocalXpose berhasil digunakan!"

    - name: 🚀 Jalankan Tunnel RDP
      run: |
        Start-Process -FilePath ".\lx.exe" -ArgumentList "tcp 3389 --region ap" -NoNewWindow
        Start-Sleep -Seconds 10
        Write-Host "✅ Tunnel RDP aktif!"
        .\lx.exe tunnels list

    - name: 📋 Tampilkan Info Login
      run: |
        Write-Host ""
        Write-Host "===================================="
        Write-Host " 🎮 WINDOWS RDP ACTIVE!"
        Write-Host "===================================="
        Write-Host "Username : Ady"
        Write-Host "Password : Akudankamu1@"
        Write-Host "Gunakan alamat tunnel dari output di atas (contoh: tcp://0.tcp.ap.localxpose.io:xxxxx)"
        Write-Host "===================================="
        Write-Host "⏳ Session bertahan hingga 3 jam."
